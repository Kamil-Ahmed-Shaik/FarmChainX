package com.farmchainx.backend.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.farmchainx.backend.dto.ProfileResponse;
import com.farmchainx.backend.entity.Admin;
import com.farmchainx.backend.entity.Distributor;
import com.farmchainx.backend.entity.Farmer;
import com.farmchainx.backend.entity.Retailer;
import com.farmchainx.backend.entity.User;
import com.farmchainx.backend.repository.AdminRepository;
import com.farmchainx.backend.repository.DistributorRepository;
import com.farmchainx.backend.repository.FarmerRepository;
import com.farmchainx.backend.repository.RetailerRepository;
import com.farmchainx.backend.repository.UserRepository;

@Service
public class UserService {

    @Autowired private UserRepository userRepo;
    @Autowired private FarmerRepository farmerRepo;
    @Autowired private DistributorRepository distributorRepo;
    @Autowired private RetailerRepository retailerRepo;
    @Autowired private AdminRepository adminRepo;

    public ProfileResponse getProfile(Long id) {
        User user = userRepo.findById(id).orElseThrow();

        ProfileResponse res = new ProfileResponse();
        res.setUserId(user.getId());
        res.setUsername(user.getUsername());
        res.setRole(user.getRole());

        switch (user.getRole()) {
            case "FARMER" -> {
                Farmer f = farmerRepo.findById(id).orElseThrow();
                res.setFarmName(f.getFarmName());
                res.setCropType(f.getCropType());
                res.setLocation(f.getLocation());
                if (user.getRole().equals("FARMER")) {
                    Farmer f = farmerRepo.findById(userId).orElseThrow();
                    f.setFarmName(dto.getFarmName());
                    f.setCropType(dto.getCropType());
                    f.setLocation(dto.getLocation());
                    f.setFarmLocation(dto.getFarmLocation());
                    f.setAadhar(dto.getAadhar());
                    f.setSoilType(dto.getSoilType());
                    f.setStatus("PENDING"); // reset on edit
                    farmerRepo.save(f);
                }

            }
            case "DISTRIBUTOR" -> {
                Distributor d = distributorRepo.findById(id).orElseThrow();
                res.setCompanyName(d.getCompanyName());
                res.setRegion(d.getRegion());
            }
            case "RETAILER" -> {
                Retailer r = retailerRepo.findById(id).orElseThrow();
                res.setShopName(r.getShopName());
                res.setLocation(r.getLocation());
            }
            case "ADMIN" -> {
                Admin a = adminRepo.findById(id).orElseThrow();
                res.setDepartment(a.getDepartment());
            }
        }

        return res;
    }
}
